- type: custom-api
  title: Karakeep Dashboard
  cache: 5m
  method: GET
  options:
    limit: 10
    collapse-after: 6
    in-new-tab: true
  headers:
    Authorization: Bearer ${KARAKEEP_API_KEY}
    Accept: application/json
  url: https://${KARAKEEP_URL}/api/v1/users/me/stats
  template: |
    {{/* Statistiche da primo endpoint */}}
    <div class="flex justify-center items-center gap-10 text-center" style="margin-bottom:1rem;">
      <div>
        <div class="color-highlight size-h3">{{ .JSON.Int "numBookmarks" | formatNumber }}</div>
        <div class="size-h6">BOOKMARKS</div>
      </div>

      <div style="width:1px; height:40px; background-color: rgba(255,255,255,0.2);"></div>

      <div>
        <div class="color-highlight size-h3">{{ .JSON.Int "numTags" | formatNumber }}</div>
        <div class="size-h6">TAGS</div>
      </div>
    </div>

    {{/* Ora richiedi la lista degli ultimi segnalibri con newRequest */}}
    {{ $limit := .Options.IntOr "limit" 10 }}
    {{ $collapseAfter := .Options.IntOr "collapse-after" 6 }}
    {{ $newTab := .Options.BoolOr "in-new-tab" false }}
    {{ $urlBookmarks := printf "https://%s/api/v1/bookmarks?limit=%d" "${KARAKEEP_URL}" $limit }}

    {{ $respBookmarks := newRequest $urlBookmarks
      | withHeader "Authorization" (printf "Bearer %s" "${KARAKEEP_API_KEY}")
      | withHeader "Accept" "application/json"
      | getResponse }}
    {{ $bookmarks := $respBookmarks.JSON.Array "bookmarks" }}

    <ul class="list list-gap-10 collapsible-container" data-collapse-after="{{ $collapseAfter }}" style="max-width:100%; overflow-x:hidden; font-size:1em; line-height:1.3em; padding-left:0; margin:0;">
      {{ range $b := $bookmarks }}
        {{ $content := $b.Get "content" }}
        {{ $title := $content.String "title" }}
        {{ $url := $content.String "url" }}
        <li style="list-style:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
          <a href="{{ $url }}"
             title="{{ $title }}"
             {{ if $newTab }} target="_blank" rel="noopener"{{ end }}
             class="color-highlight" style="text-decoration:none; cursor:pointer;">
            {{ $title }}
          </a>
        </li>
      {{ end }}
    </ul>
